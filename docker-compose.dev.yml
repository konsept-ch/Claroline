services:
  web:
    container_name: claroline-web
    build:
      context: .
      dockerfile: .docker.dev/web/Dockerfile
    ports:
      - "8088:80"
      - "8080:8080"
      - "8443:443"
    volumes:
      - ./:/var/www/html/claroline
      # Keep heavy/volatile dirs inside the Linux FS to avoid slow Windows bind-mount stats
      - vendor:/var/www/html/claroline/vendor
      - cache:/var/www/html/claroline/var/cache
      - logs:/var/www/html/claroline/var/log
      - geoip-data:/var/www/html/claroline/var/geoip
    depends_on:
      - db
      - mailhog
    environment:
      - APP_URL=http://localhost:8088
      - ENV=DEV
      - APP_ENV=dev
      - APP_DEBUG=1
      - NODE_ENV=development
      - NODE_OPTIONS=--max_old_space_size=4096
      - WEBPACK_DEV_SERVER=0
      - GEOIP_DISABLE=1
      - SKIP_REBUILD=0
      - DB_HOST=db
      - DB_NAME=claroline
      - DB_USER=claroline
      - DB_PASSWORD=claroline
      - SECRET="secret-claroline"
      - ADMIN_FIRSTNAME=John
      - ADMIN_LASTNAME=Doe
      - ADMIN_USERNAME=root
      - ADMIN_PASSWORD=claroline
      - ADMIN_EMAIL=claroline@example.com
      - PLATFORM_NAME=Claroline
      - PLATFORM_SUPPORT_EMAIL=claroline@example.com

  db:
    container_name: claroline-db
    environment:
      MYSQL_ROOT_PASSWORD: claroline
      MYSQL_USER: claroline
      MYSQL_PASSWORD: claroline
      MYSQL_DATABASE: claroline
    image: mysql:8.0
    ports:
      - "3307:3306"
    volumes:
      - ../mysql:/var/lib/mysql
      - ./.docker.dev/mysql:/etc/mysql/conf.d

  mailhog:
    container_name: claroline-mailhog
    image: mailhog/mailhog:latest
    restart: unless-stopped
    ports:
      - "8025:8025"  # Web UI
      - "1025:1025"  # SMTP

volumes:
  geoip-data:
  vendor:
  cache:
  logs:
